<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type"  content="multipart/form-data; charset=utf-8" />
    <meta name="description" content="login page" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>运营管理系统</title>
	
    <link href="/r/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/r/css/font-awesome.min.css" rel="stylesheet" />
    <link id="beyond-link" href="/r/css/beyond.min.css" rel="stylesheet" />
    <link href="/r/css/demo.min.css" rel="stylesheet" />
    <link href="/r/css/animate.min.css" rel="stylesheet" />
    <link href="/r/css/skins/azure.min.css" rel="stylesheet" type="text/css" />
    <link href="/r/css/dataTables.bootstrap.css" rel="stylesheet" />
    <link href="/r/css/fileinput.min.css" rel="stylesheet" />
    <link href="/r/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />

    <script src="/r/js/skins.min.js"></script>
    <script src="/r/js/jquery-2.1.1.js"></script>
    <script src="/r/js/bootstrap.min.js"></script>
    <script src="/r/js/angular.min.js"></script>
    <script src="/r/js/toastr.js"></script>
	<script src="/r/js/ui-bootstrap-tpls.js"></script>
	<script src="/r/js/fileinput.min.js"></script>
	<script src="/r/js/distpicker.data.js"></script>
	<script src="/r/js/distpicker.js"></script>	
	<script src="/r/js/bootstrap-datetimepicker.js"></script>
	<!-- 日期汉化插件 -->
	<script src="/r/js/bootstrap-datepicker.js"></script>
	<script src="/r/js/bootstrap-datepicker.zh-CN.js"></script>
	
</head>

<body ng-app="myApp" ng-controller="myCtrl">
	<!-- 头部 -->
	<div id="header_id" ng-include="'/admin/include/header.htm'"></div>
	<!-- 头部 -->
	   
    <div class="main-container container-fluid">
        <div class="page-container">
        
        	<!-- 菜单 -->
        	<div class="page-sidebar" id="sidebar" ng-include="'/admin/include/menu.htm'"></div>
        	<!-- 菜单 -->
            
            <!-- 右半页 -->
            <div class="page-content">
            	<div class="page-breadcrumbs">
                    <ul class="breadcrumb">
                        <li>
                            <i class="fa fa-comments"></i>
                            <a href="/admin/main.htm">首页</a>
                        </li>
						<li>
							<a href="/admin/rent/rentOrder.htm">订单列表</a>
						</li>
						<li class="active">订单详情</li>
                    </ul>
                </div>
                
                <div class="page-body">
                    <div class="row">
                        <div class="col-xs-12 col-md-12">
                        
                            <div class="widget">
                                <div class="widget-header ">
                                    <span class="widget-caption">种植订单详情</span>
                                </div>
                                <div class="widget-body">

                                	 <!-- 订单框 -->
			                        <div class="table table-striped table-bordered table-hover" style="margin-bottom:20px;padding:10px;"> 	
			                           <div class="order-left" style="height:100px;width:40%;float:left;margin-left:5%;">
				                            <div class="row" style="margin:5px;">订单编号:{{rentOrder.orderNo}}</div>	
				                            <div class="row" style="margin:5px;">付款方式:{{rentOrder.payType}}</div>	
				                            <div class="row" style="margin:5px;">商家订单号:{{rentOrder.payNo}}</div>				                            
						    			</div>	
						    			 <div class="order-right" style="height:100px;width:40%;float:left;">
				                            <div class="row" style="margin:5px;">订单状态:{{{1:'待支付',2:'支付超时',3:'支付失败',4:'待种植',5:'已种植',6:'已完成'}[rentOrder.status]}}</div>	
				                            <div class="row" style="margin:5px;">配送方式:</div>	
				                            <div class="row" style="margin:5px;">友情提示:<br/>
				                           	&nbsp;&nbsp;&nbsp;&nbsp; 如果无法进行发货,请及时联系买家进行妥善处理
				                            </div>					                           				                            
						    			</div>	
						    			<div style="clear:both;"></div>				    										    		
						    		 </div>  
		                             <!-- 订单框 -->   
							    
                                   	<!-- 土地信息  <table class="table table-bordered" id="simpledatatable">-->
                                   	<div>
                                   		<h3>土地信息</h3>
                                   		<div>
                                   			<table class="table">                       
                                   			<thead>
	                                   			<tr>
                                            	<th style="text-align:center;">
                                                   	 名称
                                                </th>
                                                <th style="text-align:center;">
                                                   	编号
                                                </th>
                                                <th style="text-align:center;">
                                                                                             价格                                      	
                                                </th>
                                                 <th style="text-align:center;">
                                                   	种植面积
                                                </th>
                                                 <th style="text-align:center;">
                                                   	总金额
                                                </th>
                                                <th style="text-align:center;">
                                                                                             预期到期时间                                                                                            
                                                </th>                                                                                              
                                            </tr>
                                        	</thead>
	                                        <!-- <tbody ng-repeat="rentOrder in list">    --> 
	                                        <tbody>                                   	
	                                        	<tr style="text-align:center;">
	                                        		<td style="display:none;">{{rentOrder.id}}</td>
	                                        		<td>
	                                        			<!--  
	                                        			<img alt="" ng-src="{{picUrl + order.cover}}" style="height:100px;width:100px;">
														-->
														{{rentOrder.name}}
													</td>
	                                        		<td>
	                                        			{{rentOrder.code}}
	                                        		</td>
	                                        		<td>
	                                        			{{rentOrder.areageCost}}/㎡  											                                    			
	                                        		</td>
	                                        		<td>
	                                        			{{rentOrder.area}}  	
													</td>
													<td>
	                                        			{{rentOrder.totalAmount}}  	
													</td>
	                                        		<td>                                       			 
	                                        			 {{parseDate(rentOrder.expireTime)}} 
	                                        			  <button class="btn btn-primary" ng-click="showExpireMsg(rentOrder.expireTime)">立即更新</button>                                    			
													</td>                                        		
	                                        	</tr>
	                                        </tbody>	
	                                        </table>                                  
                                   		</div>
                                   	</div>
                                   	<!-- 土地信息 -->
                                   	
                                   	<!-- 种植详情-->
                                   	<div>
                                   		<h3>种植详情</h3>
                                   		<div>
                                   			<table class="table">                       
                                   			<thead>
	                                   			<tr>	
	                                            	<th style="text-align:center;">
	                                                   	 种子名称
	                                                </th>
	                                                <th style="text-align:center;">
	                                                   	种植面积
	                                                </th>
	                                                <th style="text-align:center;">
	                                                                                             单价                                    	
	                                                </th>
	                                                 <th style="text-align:center;">
	                                                   	播种状态
	                                                </th>
	                                                <th style="text-align:center;">
	                                                                                             播种时间
	                                                </th> 
	                                                <th style="text-align:center;">
	                                                                                             预计成熟时间
	                                                </th><th style="text-align:center;">
	                                                                                             操作
	                                                </th>                                              
	                                            </tr>
                                        	</thead>
	                                        <!-- <tbody ng-repeat="rentOrder in list">    --> 
	                                        <tbody ng-repeat="seedDetail in seedDetailList">                                   	
	                                        	<tr style="text-align:center;">
	                                        		<td>	                                        			
														{{seedDetail.name}}
													</td>
	                                        		<td>
	                                        			{{seedDetail.area}}
	                                        		</td>
	                                        		<td>
	                                        			{{seedDetail.price}}/㎡										                                    			
	                                        		</td>
	                                        		<td>
	                                        		{{{1:'待种植',2:'已种植',3:'已成熟'}[seedDetail.plantStatus]}}
	                                        		<button class="btn btn-primary" ng-if="seedDetail.plantStatus==1" ng-click="changeStatus(rentOrder.id,seedDetail.plantStatus)">种植</button> 
													<button class="btn btn-primary" ng-if="seedDetail.plantStatus==2" ng-click="changeStatus(rentOrder.id,seedDetail.plantStatus)">成熟</button>	
													</td>
	                                        		<td>                                       			 
	                                        			 {{parseDate(seedDetail.plantTime)}}                                  			
													</td>   
													<td>                                       			 
	                                        			 {{parseDate(seedDetail.matureTime)}}
	                                        			 <button class="btn btn-primary" ng-click="showMatureMsg(seedDetail.id,seedDetail.plantTime)">立即更新</button>                                      			
													</td>  
													<td> 									                                    																                                       			                                  	                                       		
	                                        			<button class="btn btn-primary" ng-click="showStatusMsg(seedDetail.id)">状态跟踪</button>                                    			
													</td>                                     		
	                                        	</tr>
	                                        </tbody>
	                                        </table>	                                  
                                   		</div>
                                   	</div>
                                   	<!-- 种植详情 -->
                                   	
                                   <!-- 每期详情-->
                                   	<div>
                                   		<h3>每期详情</h3>
                                   		<div>
                                   			<table class="table">                       
                                   			<thead>
	                                   			<tr>	
	                                   			<th style="text-align:center;">
                                                   	 配送序号
                                                </th>                                   			
                                            	<th style="text-align:center;">
                                                   	 快递公司
                                                </th>
                                                <th style="text-align:center;">
                                                   	快递单号
                                                </th>
                                                 <th style="text-align:center;">
                                                                                             收货信息
                                                </th>
                                                <th style="text-align:center;">
                                                                                             配送时间                                      	
                                                </th>                                                                                                                                                 
                                                <th style="text-align:center;">
                                                                                              状态                                        
                                                </th> 
                                                <th style="text-align:center;">
                                                                                             操作
                                                </th>                                               
                                            </tr>
                                        	</thead>
	                                        <tbody ng-repeat="shipInfo in shipInfoList">                                   	
	                                        	<tr style="text-align:center;">	 
	                                        	    <td>	                                        			
														{{shipInfo.serial}}
													</td>                                   		
	                                        		<td ng-if="shipInfo.shipName!=''&&shipInfo.shipName!=null">	                                        			
														{{shipInfo.shipName}}
													</td>
													<td ng-if="shipInfo.shipName==''||shipInfo.shipName==null">	                                        			
														暂无物流信息
													</td>
													<td ng-if="shipInfo.shipNo!=''&&shipInfo.shipName!=null">	                                        			
														{{shipInfo.shipNo}}
													</td>
													<td ng-if="shipInfo.shipNo==''||shipInfo.shipNo==null">	                                        			
														暂无物流信息													
													</td>	                                        			                                        			
	                                        		<td>
	                                        			{{shipInfo.address}},{{shipInfo.receiveName}},{{shipInfo.receiveMobile}}									                                    			
	                                        		</td> 
	                                        		<td ng-if="shipInfo.shipTime!=''&&shipInfo.shipTime!=null">
	                                        			{{parseDate(shipInfo.shipTime)}}											                                    			
	                                        		</td>
	                                        		<td ng-if="!(shipInfo.shipTime!=''&&shipInfo.shipTime!=null)">
	                                        														                                    			
	                                        		</td>                                       		
	                                        		<td>
	                                        			{{{1:'未发货',2:'已发货',3:'确认收货'}[shipInfo.status]}}									                                    			
	                                        		</td>	                                        		
	                                        		<td>                                       			 	                                       		         	                                      			  
	                                        			 <button class="btn btn-primary" ng-if="shipInfo.status==1" ng-click="showCourierMsg(shipInfo)">立即发货</button>    
	                                        			 <button class="btn btn-primary" ng-if="shipInfo.status==2" ng-click="changeShipStatus(shipInfo)">确认收货</button>    	                                     			 
	                                        			 <button class="btn btn-default" ng-if="shipInfo.status==3">已完成</button>                            			
													</td>                                        		
	                                        	</tr>
	                                        </tbody>	
	                                        </table>                                  
                                   		</div>
                                   	</div>
                                   	<!-- 每期详情 -->
                                   	                                   	                                 
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
     
    <!-- 土地信息时间弹窗 -->
    <div class="modal-backdrop fade in" ng-if="common.showExpire"></div>
    <div class="bootbox modal fade modal-darkorange in" style="display: block" ng-show="common.showExpire">
    	<div class="modal-dialog">
	    	<div class="modal-content">	    
	    	
	    		<div class="modal-header"> 
	    			<button type="button" class="bootbox-close-button close"  ng-click="closeExpireMsg()">×</button>
	    			<h4 class="modal-title">预期到期时间</h4>
	    		</div>		    		
	    		
	    		<div class="modal-body">
		    		<div class="bootbox-body">
		    			<div class="form-horizontal">
		    				    					    							    			
			    			<div class="form-group">
			    				<label for="inputEmail3" class="col-sm-2 control-label no-padding-right">更新时间</label>
			    				<div class="col-sm-10">	                            		
	                            	<input class="form-control date-picker" id="expireDate" ng-model="update.expireTime" type="text" data-date-format="dd-mm-yyyy">                            	
	                        	</div>
			    			</div>		    						    										

		    			</div>
		    		</div>
		    	</div>
		    	
		    	<div class="modal-footer">
		    		<button type="button" class="btn btn-warning" ng-click="closeExpireMsg()">取消</button>
		    		<button type="button" class="btn btn-primary" ng-click="submitExpire()">确定</button>
		    	</div>
		    	
	    	</div>
	    </div>
    </div>     
     <!-- 土地信息时间弹窗 -->
        
    <!-- 成熟时间弹窗 -->
    <div class="modal-backdrop fade in" ng-if="common.showMature"></div>
    <div class="bootbox modal fade modal-darkorange in" style="display: block" ng-show="common.showMature">
    	<div class="modal-dialog">
	    	<div class="modal-content">	    
	    	
	    		<div class="modal-header"> 
	    			<button type="button" class="bootbox-close-button close"  ng-click="closeMatureMsg()">×</button>
	    			<h4 class="modal-title">成熟时间</h4>
	    		</div>		    		
	    		
	    		<div class="modal-body">
		    		<div class="bootbox-body">
		    			<div class="form-horizontal">
		    				    					    							    			
			    			<div class="form-group">
			    				<label for="inputEmail3" class="col-sm-2 control-label no-padding-right">更新时间</label>
			    				<div class="col-sm-10">	                            		
	                            	<input class="form-control date-picker" id="matureDate" ng-model="update.matureTime" type="text" data-date-format="dd-mm-yyyy">                            	
	                        	</div>
			    			</div>		    						    										

		    			</div>
		    		</div>
		    	</div>
		    	
		    	<div class="modal-footer">
		    		<button type="button" class="btn btn-warning" ng-click="closeMatureMsg()">取消</button>
		    		<button type="button" class="btn btn-primary" ng-click="submitMature()">确定</button>
		    	</div>
		    	
	    	</div>
	    </div>
    </div>     
     <!-- 成熟时间弹窗 -->
     
    
    
    <!--状态跟踪弹窗 -->
    <div class="modal-backdrop fade in" ng-if="common.showStatus"></div>
    <div class="bootbox modal fade modal-darkorange in" style="display: block;" ng-show="common.showStatus">
    	<div class="modal-dialog">
	    	<div class="modal-content">
	    	
	    		<div class="modal-header"> 
	    			<button type="button" class="bootbox-close-button close"  ng-click="closeStatusMsg()">×</button>
	    			<h4 class="modal-title"><button class="btn btn-primary" ng-click="showAddProgress()" data-toggle="modal" data-target="#myAddModel"><i class="glyphicon glyphicon-plus"></i>新增进展</button></h4>
	    		</div>
	    		
	    		<div class="modal-body" style="height:500px;overflow-y:scroll;overflow-x:hidden;">
		    		<div class="bootbox-body">
		    			<div class="form-horizontal">
							 <div class="package-status">
						        <div class="status-box">
						            <ul class="status-list">
						                <li ng-repeat="progressInfo in progressInfoList">
						                    <div class="status-content-before">{{parseDateTime(progressInfo.reportTime)}}&nbsp;&nbsp;&nbsp;<i class="glyphicon glyphicon-trash"
						                     ng-click="deleteProgressInfoById(progressInfo.id)" style="cursor:pointer;"></i></div>
						                    <div class="status-time-before" style="display: table-cell;">
						                    	<p style="margin-left:20px;display:block">{{progressInfo.content}}</p>
						                    	<div class="col-sm-2" ng-repeat="pic in progress.pics.split(';')">
				                        			<img alt="" ng-src="progressInfo.pics" style="height:100%;width:100%;">
				                          		</div>
											</div>
						                    <div class="status-line"></div>
						                </li>
						            </ul>
						        </div>
						    </div>
		    			</div>
		    		</div>
		    	</div>
	    	</div>
	    </div>
	</div>    
	
	<!-- 模态框（Modal）新增 -->
	<div class="modal fade in" id="myAddModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<div class="modal-header"> 
		    			<h4 class="modal-title">添加项目进度</h4>
		    		</div>
				</div>
				<div class="modal-body" style="height:500px;overflow-y:scroll;overflow-x:hidden">
					<div class="form-group">
	    				<label for="inputEmail3" class="col-sm-2 control-label no-padding-right">内容</label>
	    				<div class="col-sm-10">      
	                       	<textarea class="form-control" ng-model='orderProInfo.content' cols="30" rows="5" style="resize:none;"></textarea>
	                  	</div>
				    </div>
				    			
	    			<div class="form-group" style="margin-top:130px;">
	          			<label class="col-sm-2 control-label no-padding-right">图片说明</label>
	               		<div class="col-sm-10">
	               			<input id="addImg" type="file" class="file" name="addPro" multiple 
	                 			data-show-upload="false" data-show-caption="true" data-msg-placeholder="请限制图片大小在400K以内" accept="image/png,image/jpeg">
	                		</div>
	         		</div>
		    		<button type="button" class="btn btn-primary" ng-click="addStatus()" style="float:right;margin-top:10px;margin-right:20px">保存</button>
			    </div>
			</div>
	   	</div>
	</div>
	<!-- 模态框（Modal）新增 -->
    <!--状态跟踪弹窗 -->
     
     
       <!-- 发货弹窗-->   
    <div class="modal-backdrop fade in" ng-if="common.showCourier"></div>
    <div class="bootbox modal fade modal-darkorange in" style="display: block" ng-show="common.showCourier">
    	<div class="modal-dialog">
	    	<div class="modal-content">	    
	    	
	    		<div class="modal-header"> 
	    			<button type="button" class="bootbox-close-button close"  ng-click="closeCourierMsg()">×</button>
	    			<h4 class="modal-title">立即发货</h4>
	    		</div>		    		
	    		
	    		<div class="modal-body">
		    		<div class="bootbox-body">
		    			<div class="form-horizontal">
		    				    			
		    				<div class="form-group">
			    				<label class="col-sm-2 control-label no-padding-right">收货人</label>
			    				<div class="col-sm-10">
	                            	<lable class="form-control">{{shippingInfo.receiveName}}/{{shippingInfo.receiveMobile}}</lable>	                            	
	                        	</div>
			    			</div>	
			    		
			    			<input type="text" name="someData" ng-model="shippingInfo.serial" style="display: none;"/>
			    			<input type="text" name="someData" ng-model="shippingInfo.id" style="display: none;"/>
			    			
			    			<div class="form-group">
			    				<label  class="col-sm-2 control-label no-padding-right">快递公司</label>
			    				<div class="col-sm-10">
	                            	<input type="text" class="form-control" ng-model='shippingInfo.shipName'>	                            	
	                        	</div>
			    			</div>		    						    			

							<div class="form-group">
			    				<label  class="col-sm-2 control-label no-padding-right">快递单号</label>
			    				<div class="col-sm-10">
	                            	<input type="text" class="form-control" ng-model='shippingInfo.shipNo'>	                            	
	                        	</div>
			    			</div>	

		    			</div>
		    		</div>
		    	</div>
		    	
		    	<div class="modal-footer">
		    		<button type="button" class="btn btn-warning" ng-click="closeCourierMsg()">取消</button>
		    		<button type="button" class="btn btn-primary" ng-click="submitCourier()">确定</button>
		    	</div>
		    	
	    	</div>
	    </div>
    </div>
    <!-- 发货弹窗 -->
     
     
     
    <script src="/r/js/beyond.min.js"></script>
</body>

<script type="text/javascript">
var app = angular.module("myApp", ["ui.bootstrap"]);
app.controller("myCtrl", function($scope,$http,$timeout) {
	$scope.picUrl="https://wx.changxianshequ.com/r";		
	
	$scope.common = {
			showStatus:false,
			showCourier:false,
			showExpire:false,
			showMature:false,
			
		};
	$scope.update={
			expireTime:'',
			seedDetailId:'',
			matureTime:'',
	}
	
	$scope.formData = {
			id:'',			
		}
	
	$scope.shipInfo={}
		
	$scope.getParams=function(name) {
	    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");  
	    var r = window.location.search.substr(1).match(reg);  
	    if (r != null) return unescape(r[2]);  
	    return null;  
	}
	
	$scope.showCourierMsg = function(shipInfo) {
		$scope.shippingInfo=shipInfo;
		$scope.common.showCourier = true;
	}
	
	$scope.closeCourierMsg = function() {
		$scope.common.showCourier = false;
	}
	
	//获取状态跟踪的信息
	$scope.getProgressInfoList=function(){		
		$http({
	        method  : 'POST',
	       	url     : '/rentOrder/getProgressInfoList.htm',
	        params:{
	            'projectId':$scope.update.seedDetailId,
	        },
        	headers : {'Content-Type' : 'application/x-www-form-urlencoded'}  //angularjs设置文件上传的content-type修改方式		
	    }).then(function(response) {
	    	if(!response.data.success) {
				Notify("操作失败！", 'top-right', '4000', 'danger', 'fa-bolt', true);
				return;
			}
	    	$scope.progressInfoList = response.data.progressInfoList;	    	
	    });		
	}
	$scope.showStatusMsg = function(seedDetaild) {
		$scope.update.seedDetailId=seedDetaild;
		$scope.getProgressInfoList();				
		$scope.common.showStatus=true;
	}

	
	$scope.closeStatusMsg = function() {
		$scope.common.showStatus = false;
	}
	
	$scope.showExpireMsg = function(expireTime) {			
		$scope.update.expireTime=$scope.parseDate(expireTime);
		$scope.common.showExpire = true;
	}
	
	$scope.closeExpireMsg = function() {
		$scope.common.showExpire = false;
	}
	
	$scope.showMatureMsg = function(seedDetailId,matureTime) {
		$scope.update.seedDetailId=seedDetailId;
		$scope.update.matureTime=$scope.parseDate(matureTime);
		$scope.common.showMature = true;
	}
	
	$scope.closeMatureMsg = function() {
		$scope.common.showMature = false;
	}

	
    $("#expireDate").datepicker({
        minView : "month", //选择日期后，不会再跳转去选择时分秒
        format : "yyyy-mm-dd", //选择日期后，文本框显示的日期格式
        language : 'zh-CN', //汉化
        autoclose : true//选择日期后自动关闭
     });
    $("#matureDate").datepicker({
        minView : "month", 
        format : "yyyy-mm-dd", 
        language : 'zh-CN', 
        autoclose : true
     });

	
	$scope.pageChanged = function() {
		$scope.formData.id=$scope.getParams("rentOrderId");
		$http({
	        method  : 'POST',
	        url     : '/rentOrder/getRentOrderDetail.htm',
	        data    : $.param($scope.formData),
	        headers : {'Content-Type': 'application/x-www-form-urlencoded'},
	    }).then(function(response) {
	    	//$scope.list = response.data.rentOrderVoList;
	    	$scope.rentOrder = response.data.rentOrder;	    	
	    	$scope.shipInfoList=response.data.shipInfoList;
	    	$scope.seedDetailList=response.data.seedDetailList;
	    });
		
	}
	$scope.pageChanged();
	
	$scope.parseDate = function(endDate) {
		if(endDate!=''&&endDate!=null){
			return endDate.substring(0,4) + '年' + endDate.substring(4,6) + '月' + endDate.substring(6,8)+'日';
		}		
	}
	
	$scope.parseDateTime = function(endDate) {
		return endDate.substring(0,4) + '-' + endDate.substring(4,6) + '-' + endDate.substring(6,8) + " " + endDate.substring(8,10) + ":" + endDate.substring(10,12);
	}
	
	$scope.formatDateTime= function(dateTime) {
		return dateTime.substring(0,4) + dateTime.substring(5,7) + dateTime.substring(8,10);
	}
	
	//更新预期到期时间
	$scope.submitExpire = function(){
		if($scope.update.expireTime == '') {
			Notify("请选择更新日期！", 'top-right', '4000', 'danger', 'fa-bolt', true);
			return;
		}

		var fd = new FormData();
		fd.append("id",$scope.formData.id)
		fd.append("expireTime", $scope.formatDateTime($scope.update.expireTime));
		$http({
		 	method  : 'POST',
	        url     : '/rentOrder/editRentOrder.htm',
	        data : fd,
            transformRequest: angular.identity,
        	headers : {'Content-Type' : undefined} 
		}).then(function(response){
			if(!response.data.success) {
				Notify("操作失败！", 'top-right', '4000', 'danger', 'fa-bolt', true);
				return;
			}
			Notify('操作成功', 'top-right', '5000', 'success', 'fa-check', true);

			$scope.common.showExpire=false;
			$scope.pageChanged();
						
		});
	}
	
	//更新成熟时间
	$scope.submitMature = function(){
		if($scope.update.matureTime == '') {
			Notify("请选择更新日期！", 'top-right', '4000', 'danger', 'fa-bolt', true);
			return;
		}
		var fd = new FormData();
		fd.append("id",$scope.update.seedDetailId);
		fd.append("matureTime", $scope.formatDateTime($scope.update.matureTime));
		$http({
		 	method  : 'POST',
	        url     : '/rentOrder/editSeedDetail.htm',
	        data : fd,
            transformRequest: angular.identity,
        	headers : {'Content-Type' : undefined}  
		}).then(function(response){
			if(!response.data.success) {
				Notify("操作失败！", 'top-right', '4000', 'danger', 'fa-bolt', true);
				return;
			}
			Notify('操作成功', 'top-right', '5000', 'success', 'fa-check', true);

			$scope.common.showMature=false;
			$scope.pageChanged();
						
		});
	}
	
	//改变种子信息的状态
	$scope.changeStatus = function(seedDetailId,plantStatus){
		var fd = new FormData();
		fd.append("id",seedDetailId);
		fd.append("plantStatus",plantStatus);
		$http({
		 	method  : 'POST',
	        url     : '/rentOrder/changeStatus.htm',
	        data : fd,
            transformRequest: angular.identity,
        	headers : {'Content-Type' : undefined}  
		}).then(function(response){
			if(!response.data.success) {
				Notify("操作失败！", 'top-right', '4000', 'danger', 'fa-bolt', true);
				return;
			}
			Notify('操作成功', 'top-right', '5000', 'success', 'fa-check', true);
			$scope.pageChanged();					
		});
	}
	
	//添加状态跟踪
	$scope.addStatus = function(){
		if($scope.orderProInfo.content == '') {
			Notify("请输入进度内容！", 'top-right', '4000', 'danger', 'fa-bolt', true);
			return;
		}
		if(document.querySelector('input[name="addPro"]').files[0] == null){
			Notify("请输入图片说明！", 'top-right', '4000', 'danger', 'fa-bolt', true);
			return;
		}
		
		var fd = new FormData();
		for(var i=0; i < document.querySelector('input[name="addPro"]').files.length; i++) {
		    fd.append("files", document.querySelector('input[name="addPro"]').files[i]);
		}		
		fd.append("projectId",$scope.update.seedDetailId);
		fd.append("content", $scope.orderProInfo.content);
		
		$http({
		 	method  : 'POST',
		 	url     : '/rentOrder/addStatus.htm',	        
	        data : fd,     
            transformRequest: angular.identity,
	        headers : {'Content-Type' : undefined}
		}).then(function(response){
			if(!response.data.success) {
				Notify("操作失败！", 'top-right', '4000', 'danger', 'fa-bolt', true);
				submitNow = false;
				return;
			}
		
			Notify('添加成功', 'top-right', '5000', 'success', 'fa-check', true);
			$('#myAddModel').modal('hide');
			$(".fileinput-remove-button").click();		
			$scope.orderProInfo = {
					content:''
			}
			$scope.getProgressInfoList();			
		});			
	}	
	
	//删除状态信息
	$scope.deleteProgressInfoById = function(id){
		if(window.confirm("你确定删除这个项目进展吗？")){
			
		}else{
			return false;
		}
		$http({
	        method  : 'POST',
	        url     : '/crowdFunding/deleteProgressInfoById.htm',
	        params:{
	            'id':id
	        },
	        headers : {'Content-Type': 'application/x-www-form-urlencoded'},
	    }).then(function(response) {
	    	if(!response.data.success) {
				Notify("删除失败！", 'top-right', '4000', 'danger', 'fa-bolt', true);
				return;
			}
	    	Notify('删除成功', 'top-right', '5000', 'success', 'fa-check', true);
	    	$scope.getProgressInfoList();
	    });
	}
		
	
	//确认收货
	$scope.changeShipStatus = function(shippingInfo){		
		$http({
		 	method  : 'POST',
	        url     : '/rentOrder/changeShipStatus.htm',
	        data    : $.param(shippingInfo),
            transformRequest: angular.identity,
            headers : {'Content-Type': 'application/x-www-form-urlencoded'},
		}).then(function(response){
			if(!response.data.success) {
				Notify("操作失败！", 'top-right', '4000', 'danger', 'fa-bolt', true);
				return;
			}
			Notify('操作成功', 'top-right', '5000', 'success', 'fa-check', true);
			$scope.pageChanged();					
		});
	}
	
	//提交发货
	$scope.submitCourier = function(){
		if($scope.shippingInfo.shipName == '') {
			Notify("请输入快递公司！", 'top-right', '4000', 'danger', 'fa-bolt', true);
			return;
		}
		if($scope.shippingInfo.shipNo == '') {
			Notify("请输入快递单号！", 'top-right', '4000', 'danger', 'fa-bolt', true);
			return;
		}		
		
		$http({
		 	method  : 'POST',
	        url     : '/rentOrder/shippingNow.htm',
	        data    : $.param($scope.shippingInfo),
            transformRequest: angular.identity,
            headers : {'Content-Type': 'application/x-www-form-urlencoded'}, 
		}).then(function(response){
			if(!response.data.success) {
				Notify("操作失败！", 'top-right', '4000', 'danger', 'fa-bolt', true);
				return;
			}
			Notify('操作成功', 'top-right', '5000', 'success', 'fa-check', true);
			$scope.pageChanged();	
			$scope.common.showCourier=false;					
		});
	}
	
	
});	
</script>
</html>